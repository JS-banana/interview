# JavaScriptè®¾è®¡æ¨¡å¼

è®¾è®¡æ¨¡å¼æ˜¯â€œæ‹¿æ¥ä¸»ä¹‰â€åœ¨è½¯ä»¶é¢†åŸŸçš„è´¯å½»å®è·µ

- å•ä¸€åŠŸèƒ½åŸåˆ™
- å¼€æ”¾å°é—­åŸåˆ™ï¼šå¯¹æ‹“å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å°é—­ã€‚è½¯ä»¶å®ä½“ï¼ˆç±»ã€æ¨¡å—ã€å‡½æ•°ï¼‰å¯ä»¥æ‰©å±•ï¼Œä½†æ˜¯ä¸å¯ä¿®æ”¹ã€‚

è®¾è®¡æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³â€”â€”**å°è£…å˜åŒ–**

å°†å˜ä¸ä¸å˜åˆ†ç¦»ï¼Œç¡®ä¿å˜åŒ–çš„éƒ¨åˆ†çµæ´»ã€ä¸å˜çš„éƒ¨åˆ†ç¨³å®š

## è®¾è®¡æ¨¡å¼

1. åˆ›å»ºå‹

    - å·¥å‚æ¨¡å¼
    - å•ä¾‹æ¨¡å¼
    - åŸå‹æ¨¡å¼

2. ç»“æ„å‹

    - è£…é¥°å™¨æ¨¡å¼
    - é€‚é…å™¨æ¨¡å¼
    - ä»£ç†æ¨¡å¼

3. è¡Œä¸ºå‹

    - ç­–ç•¥æ¨¡å¼
    - çŠ¶æ€æ¨¡å¼
    - è§‚å¯Ÿè€…æ¨¡å¼
    - è¿­ä»£å™¨æ¨¡å¼

## å·¥å‚æ¨¡å¼

ç®€å•å·¥å‚ï¼ˆå˜ä¸ä¸å˜ï¼‰ï¼š

å·¥å‚æ¨¡å¼å…¶å®å°±æ˜¯å°†åˆ›å»ºå¯¹è±¡çš„è¿‡ç¨‹å•ç‹¬å°è£…ã€‚

- æ„é€ å‡½æ•°ä½¿ç”¨çš„åœºæ™¯
- åªä¼ å‚å³å¯ï¼Œä¸å…³å¿ƒè¿‡ç¨‹

```js
function User(name , age, career, work) {
    this.name = name
    this.age = age
    this.career = career 
    this.work = work
}

function Factory(name, age, career) {
    let work
    switch(career) {
        case 'coder':
            work =  ['å†™ä»£ç ','å†™ç³»åˆ†', 'ä¿®Bug'] 
            break
        case 'product manager':
            work = ['è®¢ä¼šè®®å®¤', 'å†™PRD', 'å‚¬æ›´']
            break
        case 'boss':
            work = ['å–èŒ¶', 'çœ‹æŠ¥', 'è§å®¢æˆ·']
        case 'xxx':
            // å…¶å®ƒå·¥ç§çš„èŒè´£åˆ†é…
            ...
            
    return new User(name, age, career, work)
}
```

æŠ½è±¡å·¥å‚ï¼ˆå¼€æ”¾å°é—­ï¼‰ï¼š

- å›´ç»•ä¸€ä¸ªè¶…çº§å·¥å‚åˆ›å»ºå…¶ä»–å·¥å‚

1. æŠ½è±¡å·¥å‚ï¼šæŠ½è±¡ç±»ï¼Œå®ƒä¸èƒ½è¢«ç”¨äºç”Ÿæˆå…·ä½“å®ä¾‹ï¼›ç”¨äºå£°æ˜æœ€ç»ˆç›®æ ‡äº§å“çš„å…±æ€§

    ```js
    // ä¾‹å¦‚æˆ‘æƒ³ç”Ÿäº§ä¸€ä¸ªæ‰‹æœºï¼Œæ‰‹æœºå·¥å‚å¦‚ä½•å®šä¹‰
    // æ‰‹æœºçš„åŸºæœ¬ç»„æˆåŒ…æ‹¬ æ“ä½œç³»ç»Ÿã€ç¡¬ä»¶ ä¸¤ä¸ªä¸»è¦éƒ¨åˆ†
    class MobilePhoneFactory {
        // æä¾›æ“ä½œç³»ç»Ÿçš„æ¥å£
        createOS(){
            throw new Error("æŠ½è±¡å·¥å‚æ–¹æ³•ä¸å…è®¸ç›´æ¥è°ƒç”¨ï¼Œä½ éœ€è¦å°†æˆ‘é‡å†™ï¼");
        }
        // æä¾›ç¡¬ä»¶çš„æ¥å£
        createHardWare(){
            throw new Error("æŠ½è±¡å·¥å‚æ–¹æ³•ä¸å…è®¸ç›´æ¥è°ƒç”¨ï¼Œä½ éœ€è¦å°†æˆ‘é‡å†™ï¼");
        }
    }
    ```

2. å…·ä½“å·¥å‚ï¼šç”¨äºç”Ÿæˆäº§å“æ—é‡Œçš„ä¸€ä¸ªå…·ä½“çš„äº§å“ï¼›ç»§æ‰¿è‡ªæŠ½è±¡å·¥å‚ã€å®ç°äº†æŠ½è±¡å·¥å‚é‡Œå£°æ˜çš„é‚£äº›æ–¹æ³•ï¼Œç”¨äºåˆ›å»ºå…·ä½“çš„äº§å“çš„ç±»ã€‚

    - æŠ½è±¡å·¥å‚ä¸å¹²æ´»ï¼Œå…·ä½“å·¥å‚ï¼ˆConcreteFactoryï¼‰æ¥å¹²æ´»ï¼

    ```js
    // å…·ä½“å·¥å‚ç»§æ‰¿è‡ªæŠ½è±¡å·¥å‚
    // æ¯”å¦‚æˆ‘ç°åœ¨æƒ³è¦ä¸€ä¸ªä¸“é—¨ç”Ÿäº§ Android ç³»ç»Ÿ + é«˜é€šç¡¬ä»¶ çš„æ‰‹æœºçš„ç”Ÿäº§çº¿
    class FakeStarFactory extends MobilePhoneFactory {
        createOS() {
            // æä¾›å®‰å“ç³»ç»Ÿå®ä¾‹
            return new AndroidOS()
        }
        createHardWare() {
            // æä¾›é«˜é€šç¡¬ä»¶å®ä¾‹
            return new QualcommHardWare()
        }
    }
    ```

3. æŠ½è±¡äº§å“ï¼šæŠ½è±¡ç±»ï¼Œå®ƒä¸èƒ½è¢«ç”¨äºç”Ÿæˆå…·ä½“å®ä¾‹

    - ç”¨ä¸€ä¸ªæŠ½è±¡äº§å“ï¼ˆAbstractProductï¼‰ç±»æ¥å£°æ˜è¿™ä¸€ç±»äº§å“åº”è¯¥å…·æœ‰çš„åŸºæœ¬åŠŸèƒ½ï¼ˆæ¯”å¦‚è¿™é‡Œçš„ æ“ä½œç³»ç»Ÿ å¯ä»¥æ§åˆ¶æ‰‹æœºç¡¬ä»¶è¿™ä¸€åŸºæœ¬åŠŸèƒ½ï¼‰

    ```js
    // å®šä¹‰æ“ä½œç³»ç»Ÿè¿™ç±»äº§å“çš„æŠ½è±¡äº§å“ç±»ï¼Œç¡¬ä»¶åŒç†
    class OS {
        controlHardWare() {
            throw new Error('æŠ½è±¡äº§å“æ–¹æ³•ä¸å…è®¸ç›´æ¥è°ƒç”¨ï¼Œä½ éœ€è¦å°†æˆ‘é‡å†™ï¼');
        }
    }
    ```

4. å…·ä½“äº§å“ï¼šç”¨äºç”Ÿæˆäº§å“æ—é‡Œçš„ä¸€ä¸ªå…·ä½“çš„äº§å“æ‰€ä¾èµ–çš„æ›´ç»†ç²’åº¦çš„äº§å“

    ```js
    // å®šä¹‰å…·ä½“æ“ä½œç³»ç»Ÿçš„å…·ä½“äº§å“ç±»
    class AndroidOS extends OS {
        controlHardWare() {
            console.log('æˆ‘ä¼šç”¨å®‰å“çš„æ–¹å¼å»æ“ä½œç¡¬ä»¶')
        }
    }

    class AppleOS extends OS {
        controlHardWare() {
            console.log('æˆ‘ä¼šç”¨ğŸçš„æ–¹å¼å»æ“ä½œç¡¬ä»¶')
        }
    }

    // ç­‰ç­‰
    // ...
    ```

å¦‚æ­¤ä¸€æ¥ï¼Œå½“æˆ‘ä»¬éœ€è¦ç”Ÿäº§ä¸€å°FakeStaræ‰‹æœºæ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦è¿™æ ·åšï¼š

```js
// è¿™æ˜¯æˆ‘çš„æ‰‹æœº
const myPhone = new FakeStarFactory()
// è®©å®ƒæ‹¥æœ‰æ“ä½œç³»ç»Ÿ
const myOS = myPhone.createOS()
// è®©å®ƒæ‹¥æœ‰ç¡¬ä»¶
const myHardWare = myPhone.createHardWare()
// å¯åŠ¨æ“ä½œç³»ç»Ÿ(è¾“å‡ºâ€˜æˆ‘ä¼šç”¨å®‰å“çš„æ–¹å¼å»æ“ä½œç¡¬ä»¶â€™)
myOS.controlHardWare()
// å”¤é†’ç¡¬ä»¶(è¾“å‡ºâ€˜æˆ‘ä¼šç”¨é«˜é€šçš„æ–¹å¼å»è¿è½¬â€™)
myHardWare.operateByOrder()
```

å‡å¦‚æœ‰ä¸€å¤©ï¼ŒFakeStarè¿‡æ°”äº†ï¼Œæˆ‘ä»¬éœ€è¦äº§å‡ºä¸€æ¬¾æ–°æœºæŠ•å…¥å¸‚åœº;ä¸éœ€è¦å¯¹æŠ½è±¡å·¥å‚MobilePhoneFactoryåšä»»ä½•ä¿®æ”¹ï¼Œåªéœ€è¦æ‹“å±•å®ƒçš„ç§ç±»ï¼š

```js
class newStarFactory extends MobilePhoneFactory {
    createOS() {
        // æ“ä½œç³»ç»Ÿå®ç°ä»£ç 
    }
    createHardWare() {
        // ç¡¬ä»¶å®ç°ä»£ç 
    }
}
```

è¿™ä¹ˆä¸ªæ“ä½œï¼Œå¯¹åŸæœ‰çš„ç³»ç»Ÿä¸ä¼šé€ æˆä»»ä½•æ½œåœ¨å½±å“ æ‰€è°“çš„â€œå¯¹æ‹“å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å°é—­â€å°±è¿™ä¹ˆåœ†æ»¡å®ç°äº†ã€‚å‰é¢æˆ‘ä»¬ä¹‹æ‰€ä»¥è¦å®ç°æŠ½è±¡äº§å“ç±»ï¼Œä¹Ÿæ˜¯åŒæ ·çš„é“ç†ã€‚

## å•ä¾‹æ¨¡å¼

ä¿è¯ä¸€ä¸ªç±»ä»…æœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›ä¸€ä¸ªè®¿é—®å®ƒçš„å…¨å±€è®¿é—®ç‚¹ï¼Œè¿™æ ·çš„æ¨¡å¼å°±å«åšå•ä¾‹æ¨¡å¼ã€‚

- ä¸ç®¡æˆ‘ä»¬å°è¯•å»åˆ›å»ºå¤šå°‘æ¬¡ï¼Œå®ƒéƒ½åªç»™ä½ è¿”å›ç¬¬ä¸€æ¬¡æ‰€åˆ›å»ºçš„é‚£å”¯ä¸€çš„ä¸€ä¸ªå®ä¾‹
- å…·å¤‡åˆ¤æ–­è‡ªå·±æ˜¯å¦å·²ç»åˆ›å»ºè¿‡ä¸€ä¸ªå®ä¾‹çš„èƒ½åŠ›

```js
class SingleDog {
    show() {
        console.log('æˆ‘æ˜¯ä¸€ä¸ªå•ä¾‹å¯¹è±¡')
    }
    static getInstance() {
        // åˆ¤æ–­æ˜¯å¦å·²ç»newè¿‡1ä¸ªå®ä¾‹
        if (!SingleDog.instance) {
            // è‹¥è¿™ä¸ªå”¯ä¸€çš„å®ä¾‹ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆå…ˆåˆ›å»ºå®ƒ
            SingleDog.instance = new SingleDog()
        }
        // å¦‚æœè¿™ä¸ªå”¯ä¸€çš„å®ä¾‹å·²ç»å­˜åœ¨ï¼Œåˆ™ç›´æ¥è¿”å›
        return SingleDog.instance
    }
}

const s1 = SingleDog.getInstance()
const s2 = SingleDog.getInstance()

// true
s1 === s2
```

## åŸå‹æ¨¡å¼

è°ˆåŸå‹æ¨¡å¼ï¼Œå…¶å®æ˜¯è°ˆåŸå‹èŒƒå¼ã€‚

åŸå‹ç¼–ç¨‹èŒƒå¼çš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯åˆ©ç”¨å®ä¾‹æ¥æè¿°å¯¹è±¡ï¼Œç”¨å®ä¾‹ä½œä¸ºå®šä¹‰å¯¹è±¡å’Œç»§æ‰¿çš„åŸºç¡€

æ¯ä¸ªæ„é€ å‡½æ•°ä¸Šéƒ½æœ‰ä¸€ä¸ªå±æ€§prototypeï¼Œä¹Ÿå°±æ˜¯åŸå‹å¯¹è±¡ï¼ŒåŸå‹å¯¹è±¡ä¸Šæœ‰ä¸ªconstroctorå±æ€§æŒ‡å›æ„é€ å‡½æ•°ã€‚

## è£…é¥°å™¨æ¨¡å¼

è£…é¥°å™¨æ¨¡å¼ï¼Œåˆåè£…é¥°è€…æ¨¡å¼ã€‚å®ƒçš„å®šä¹‰æ˜¯â€œåœ¨ä¸æ”¹å˜åŸå¯¹è±¡çš„åŸºç¡€ä¸Šï¼Œé€šè¿‡å¯¹å…¶è¿›è¡ŒåŒ…è£…æ‹“å±•ï¼Œä½¿åŸæœ‰å¯¹è±¡å¯ä»¥æ»¡è¶³ç”¨æˆ·çš„æ›´å¤æ‚éœ€æ±‚â€ã€‚

è£…é¥°å™¨æ¨¡å¼çš„ä¼˜åŠ¿åœ¨äºå…¶æå¼ºçš„çµæ´»æ€§å’Œå¯å¤ç”¨æ€§â€”â€”å®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè€Œä¸”å¾€å¾€ä¸ä¾èµ–äºä»»ä½•é€»è¾‘è€Œå­˜åœ¨ã€‚

- å‡½æ•°ä¼ å‚&è°ƒç”¨ï¼šå®šä¹‰è£…é¥°å™¨å‡½æ•°ï¼Œå°†è¢«è£…é¥°è€…â€œäº¤ç»™â€è£…é¥°å™¨

1. å½“æˆ‘ä»¬ç»™ä¸€ä¸ªç±»æ·»åŠ è£…é¥°å™¨æ—¶ï¼š

    ```js
    function classDecorator(target) {
        // target å°±æ˜¯è¢«è£…é¥°çš„ç±»æœ¬èº«
        target.hasDecorator = true
        return target
    }

    // å°†è£…é¥°å™¨â€œå®‰è£…â€åˆ°Buttonç±»ä¸Š
    @classDecorator
    class Button {
        // Buttonç±»çš„ç›¸å…³é€»è¾‘
    }
    ```

2. å½“æˆ‘ä»¬ç»™ä¸€ä¸ªæ–¹æ³•æ·»åŠ è£…é¥°å™¨æ—¶

    ```js
    // æ³¨æ„è¿™é‡Œçš„å‚æ•°å˜åŒ–
    function funcDecorator(target, name, descriptor) {
        // æ­¤å¤„çš„ target å˜æˆäº†Button.prototypeï¼Œå³ç±»çš„åŸå‹å¯¹è±¡s
        let originalMethod = descriptor.value
        descriptor.value = function() {
            console.log('æˆ‘æ˜¯Funcçš„è£…é¥°å™¨é€»è¾‘')
            return originalMethod.apply(this, arguments)
        }
        return descriptor
    }

    class Button {
        @funcDecorator
        onClick() {
            console.log('æˆ‘æ˜¯Funcçš„åŸæœ‰é€»è¾‘')
        }
    }
    ```

    - è£…é¥°å™¨å‡½æ•°è°ƒç”¨çš„æ—¶æœºæ˜¯åœ¨ç¼–è¯‘é˜¶æ®µï¼š
    - 1ï¼‰è£…é¥°å™¨å‡½æ•°æ‰§è¡Œçš„æ—¶å€™ï¼ŒButton å®ä¾‹è¿˜å¹¶ä¸å­˜åœ¨ã€‚
    - 2ï¼‰è¿™æ˜¯å› ä¸ºå®ä¾‹æ˜¯åœ¨æˆ‘ä»¬çš„ä»£ç è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆçš„ï¼Œè€Œè£…é¥°å™¨å‡½æ•°åˆ™æ˜¯åœ¨ç¼–è¯‘é˜¶æ®µå°±æ‰§è¡Œäº†ã€‚
    - 3ï¼‰æ‰€ä»¥è¯´è£…é¥°å™¨å‡½æ•°çœŸæ­£èƒ½è§¦åŠåˆ°çš„ï¼Œå°±åªæœ‰ç±»è¿™ä¸ªå±‚é¢ä¸Šçš„å¯¹è±¡ã€‚

- å°†â€œå±æ€§æè¿°å¯¹è±¡â€äº¤åˆ°ä½ æ‰‹é‡Œ

åœ¨ç¼–å†™ç±»è£…é¥°å™¨æ—¶ï¼Œæˆ‘ä»¬ä¸€èˆ¬è·å–ä¸€ä¸ªtargetå‚æ•°å°±è¶³å¤Ÿäº†ã€‚ä½†åœ¨ç¼–å†™æ–¹æ³•è£…é¥°å™¨æ—¶ï¼Œæˆ‘ä»¬å¾€å¾€éœ€è¦è‡³å°‘ä¸‰ä¸ªå‚æ•°ã€‚

ç¬¬äºŒä¸ªå‚æ•°nameï¼Œæ˜¯æˆ‘ä»¬ä¿®é¥°çš„ç›®æ ‡å±æ€§å±æ€§åï¼Œé‡ç‚¹æ˜¯ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œå®ƒçš„çœŸé¢ç›®å°±æ˜¯â€œå±æ€§æè¿°å¯¹è±¡â€â€”â€”Object.definePropertyï¼Œé€šè¿‡è¯¥å¯¹è±¡æˆ‘ä»¬å°±å¯ä»¥å¯¹ç›®æ ‡æ–¹æ³•çš„é€»è¾‘è¿›è¡Œå„ç§å„æ ·çš„æ‹“å±•äº†ã€‚

å®é™…çš„åº”ç”¨ä¸­ï¼Œé«˜é˜¶å‡½æ•°HOCçš„é€»è¾‘å¾ˆç›¸ä¼¼ã€‚

## é€‚é…å™¨æ¨¡å¼

é€‚é…å™¨æ¨¡å¼é€šè¿‡æŠŠä¸€ä¸ªç±»çš„æ¥å£å˜æ¢æˆå®¢æˆ·ç«¯æ‰€æœŸå¾…çš„å¦ä¸€ç§æ¥å£ï¼Œå¯ä»¥å¸®æˆ‘ä»¬è§£å†³ä¸å…¼å®¹çš„é—®é¢˜ã€‚

é€‚é…å™¨çš„ç”¨é€”éå¸¸å¹¿æ³›ï¼Œæ¯”å¦‚ï¼š

axios é€šè¿‡é€‚é…å™¨æ¨¡å¼ï¼ŒæŠ¹å¹³äº†æµè§ˆå™¨ä¸nodeç¯å¢ƒçš„å·®å¼‚ï¼Œä½¿å¾—å®ƒåœ¨è¿™ä¸¤ç§ç¯å¢ƒä¸­éƒ½å¯ä»¥ä½¿ç”¨ã€‚å¯¹äºä½¿ç”¨è€…æ¥è¯´ï¼Œå…¥å‚ã€å‡ºå‚çš„æ ¼å¼åˆ™å®Œå…¨ä¸€è‡´ï¼Œå‡ ä¹æ²¡æœ‰å¿ƒæ™ºè´Ÿæ‹…ã€‚

é»˜è®¤é€‚é…å™¨æ–¹æ³• getDefaultAdapterï¼š

```js
function getDefaultAdapter() {
  var adapter;
  // åˆ¤æ–­å½“å‰æ˜¯å¦æ˜¯nodeç¯å¢ƒ
  if (
    typeof process !== 'undefined' 
    && Object.prototype.toString.call(process) === '[object process]'
  ) {
    // å¦‚æœæ˜¯nodeç¯å¢ƒï¼Œè°ƒç”¨nodeä¸“å±çš„httpé€‚é…å™¨
    adapter = require('./adapters/http');
  } else if (typeof XMLHttpRequest !== 'undefined') {
    // å¦‚æœæ˜¯æµè§ˆå™¨ç¯å¢ƒï¼Œè°ƒç”¨åŸºäºxhrçš„é€‚é…å™¨
    adapter = require('./adapters/xhr');
  }
  return adapter;
}
```

http é€‚é…å™¨ï¼š

```js
module.exports = function httpAdapter(config) {
  return new Promise(function dispatchHttpRequest(resolvePromise, rejectPromise) {
    // å…·ä½“é€»è¾‘
  }
}
```

xhr é€‚é…å™¨ï¼š

```js
module.exports = function xhrAdapter(config) {
  return new Promise(function dispatchXhrRequest(resolve, reject) {
    // å…·ä½“é€»è¾‘
  }
}
```

- ä¸¤ä¸ªé€‚é…å™¨çš„å…¥å‚éƒ½æ˜¯ configï¼›
- ä¸¤ä¸ªé€‚é…å™¨çš„å‡ºå‚éƒ½æ˜¯ä¸€ä¸ª Promise

## ä»£ç†æ¨¡å¼

- vpn
- ES6ä¸­çš„Proxy
- HTMLçš„DOMäº‹ä»¶ä»£ç†

## è§‚å¯Ÿè€…æ¨¡å¼

è§‚å¯Ÿè€…æ¨¡å¼ï¼Œæ˜¯æ‰€æœ‰ JavaScript è®¾è®¡æ¨¡å¼ä¸­ä½¿ç”¨é¢‘ç‡æœ€é«˜ï¼Œé¢è¯•é¢‘ç‡ä¹Ÿæœ€é«˜çš„è®¾è®¡æ¨¡å¼ã€‚

è§‚å¯Ÿè€…æ¨¡å¼å®šä¹‰äº†ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œè®©å¤šä¸ªè§‚å¯Ÿè€…å¯¹è±¡åŒæ—¶ç›‘å¬æŸä¸€ä¸ªç›®æ ‡å¯¹è±¡ï¼Œå½“è¿™ä¸ªç›®æ ‡å¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šé€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè€…å¯¹è±¡ï¼Œä½¿å®ƒä»¬èƒ½å¤Ÿè‡ªåŠ¨æ›´æ–°ã€‚

- Vue å“åº”å¼åŸç†
- Event Bus / EventEmitter

```js
class EventEmitter {
  constructor() {
    // handlersæ˜¯ä¸€ä¸ªmapï¼Œç”¨äºå­˜å‚¨äº‹ä»¶ä¸å›è°ƒä¹‹é—´çš„å¯¹åº”å…³ç³»
    this.handlers = {}
  }

  // onæ–¹æ³•ç”¨äºå®‰è£…äº‹ä»¶ç›‘å¬å™¨ï¼Œå®ƒæ¥å—ç›®æ ‡äº‹ä»¶åå’Œå›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°
  on(eventName, cb) {
    // å…ˆæ£€æŸ¥ä¸€ä¸‹ç›®æ ‡äº‹ä»¶åæœ‰æ²¡æœ‰å¯¹åº”çš„ç›‘å¬å‡½æ•°é˜Ÿåˆ—
    if (!this.handlers[eventName]) {
      // å¦‚æœæ²¡æœ‰ï¼Œé‚£ä¹ˆé¦–å…ˆåˆå§‹åŒ–ä¸€ä¸ªç›‘å¬å‡½æ•°é˜Ÿåˆ—
      this.handlers[eventName] = []
    }

    // æŠŠå›è°ƒå‡½æ•°æ¨å…¥ç›®æ ‡äº‹ä»¶çš„ç›‘å¬å‡½æ•°é˜Ÿåˆ—é‡Œå»
    this.handlers[eventName].push(cb)
  }

  // emitæ–¹æ³•ç”¨äºè§¦å‘ç›®æ ‡äº‹ä»¶ï¼Œå®ƒæ¥å—äº‹ä»¶åå’Œç›‘å¬å‡½æ•°å…¥å‚ä½œä¸ºå‚æ•°
  emit(eventName, ...args) {
    // æ£€æŸ¥ç›®æ ‡äº‹ä»¶æ˜¯å¦æœ‰ç›‘å¬å‡½æ•°é˜Ÿåˆ—
    if (this.handlers[eventName]) {
      // è¿™é‡Œéœ€è¦å¯¹ this.handlers[eventName] åšä¸€æ¬¡æµ…æ‹·è´ï¼Œä¸»è¦ç›®çš„æ˜¯ä¸ºäº†é¿å…é€šè¿‡ once å®‰è£…çš„ç›‘å¬å™¨åœ¨ç§»é™¤çš„è¿‡ç¨‹ä¸­å‡ºç°é¡ºåºé—®é¢˜
      const handlers = this.handlers[eventName].slice()
      // å¦‚æœæœ‰ï¼Œåˆ™é€ä¸ªè°ƒç”¨é˜Ÿåˆ—é‡Œçš„å›è°ƒå‡½æ•°
      handlers.forEach((callback) => {
        callback(...args)
      })
    }
  }

  // ç§»é™¤æŸä¸ªäº‹ä»¶å›è°ƒé˜Ÿåˆ—é‡Œçš„æŒ‡å®šå›è°ƒå‡½æ•°
  off(eventName, cb) {
    const callbacks = this.handlers[eventName]
    const index = callbacks.indexOf(cb)
    if (index !== -1) {
      callbacks.splice(index, 1)
    }
  }

  // ä¸ºäº‹ä»¶æ³¨å†Œå•æ¬¡ç›‘å¬å™¨
  once(eventName, cb) {
    // å¯¹å›è°ƒå‡½æ•°è¿›è¡ŒåŒ…è£…ï¼Œä½¿å…¶æ‰§è¡Œå®Œæ¯•è‡ªåŠ¨è¢«ç§»é™¤
    const wrapper = (...args) => {
      cb(...args)
      this.off(eventName, wrapper)
    }
    this.on(eventName, wrapper)
  }
}
```

è§‚å¯Ÿè€…æ¨¡å¼ä¸å‘å¸ƒè®¢é˜…æ¨¡å¼çš„åŒºåˆ«ï¼š

- å‘å¸ƒè€…ç›´æ¥è§¦åŠåˆ°è®¢é˜…è€…çš„æ“ä½œï¼Œå«è§‚å¯Ÿè€…æ¨¡å¼
- å‘å¸ƒè€…ä¸ç›´æ¥è§¦åŠåˆ°è®¢é˜…è€…ã€è€Œæ˜¯ç”±ç»Ÿä¸€çš„ç¬¬ä¸‰æ–¹æ¥å®Œæˆå®é™…çš„é€šä¿¡çš„æ“ä½œï¼Œå«åšå‘å¸ƒ-è®¢é˜…æ¨¡å¼ã€‚

è§‚å¯Ÿè€…æ¨¡å¼å’Œå‘å¸ƒ-è®¢é˜…æ¨¡å¼ä¹‹é—´çš„åŒºåˆ«ï¼Œåœ¨äºæ˜¯å¦å­˜åœ¨ç¬¬ä¸‰æ–¹ã€å‘å¸ƒè€…èƒ½å¦ç›´æ¥æ„ŸçŸ¥è®¢é˜…è€…ã€‚

![pub-sub](/static/images/pub-sub.webp)

## è¿­ä»£å™¨æ¨¡å¼

è¿­ä»£å™¨æ¨¡å¼æä¾›ä¸€ç§æ–¹æ³•é¡ºåºè®¿é—®ä¸€ä¸ªèšåˆå¯¹è±¡ä¸­çš„å„ä¸ªå…ƒç´ ï¼Œè€Œåˆä¸æš´éœ²è¯¥å¯¹è±¡çš„å†…éƒ¨è¡¨ç¤ºã€‚

è¿­ä»£å™¨æ¨¡å¼æ˜¯è®¾è®¡æ¨¡å¼ä¸­å°‘æœ‰çš„ç›®çš„æ€§æå¼ºçš„æ¨¡å¼ã€‚æ‰€è°“â€œç›®çš„æ€§æå¼ºâ€å°±æ˜¯è¯´å®ƒä¸æ“å¿ƒåˆ«çš„ï¼Œå®ƒå°±è§£å†³è¿™ä¸€ä¸ªé—®é¢˜â€”â€”éå†ã€‚

ES6çº¦å®šï¼Œä»»ä½•æ•°æ®ç»“æ„åªè¦å…·å¤‡Symbol.iteratorå±æ€§ï¼ˆè¿™ä¸ªå±æ€§å°±æ˜¯Iteratorçš„å…·ä½“å®ç°ï¼Œå®ƒæœ¬è´¨ä¸Šæ˜¯å½“å‰æ•°æ®ç»“æ„é»˜è®¤çš„è¿­ä»£å™¨ç”Ÿæˆå‡½æ•°ï¼‰ï¼Œå°±å¯ä»¥è¢«éå†â€”â€”å‡†ç¡®åœ°è¯´ï¼Œæ˜¯è¢«for...of...å¾ªç¯å’Œè¿­ä»£å™¨çš„nextæ–¹æ³•éå†ã€‚ äº‹å®ä¸Šï¼Œfor...of...çš„èƒŒåæ­£æ˜¯å¯¹nextæ–¹æ³•çš„åå¤è°ƒç”¨ã€‚

```js
// å®šä¹‰ç”Ÿæˆå™¨å‡½æ•°ï¼Œå…¥å‚æ˜¯ä»»æ„é›†åˆ
function iteratorGenerator(list) {
    // idxè®°å½•å½“å‰è®¿é—®çš„ç´¢å¼•
    var idx = 0
    // lenè®°å½•ä¼ å…¥é›†åˆçš„é•¿åº¦
    var len = list.length
    return {
        // è‡ªå®šä¹‰nextæ–¹æ³•
        next: function() {
            // å¦‚æœç´¢å¼•è¿˜æ²¡æœ‰è¶…å‡ºé›†åˆé•¿åº¦ï¼Œdoneä¸ºfalse
            var done = idx >= len
            // å¦‚æœdoneä¸ºfalseï¼Œåˆ™å¯ä»¥ç»§ç»­å–å€¼
            var value = !done ? list[idx++] : undefined
            
            // å°†å½“å‰å€¼ä¸éå†æ˜¯å¦å®Œæ¯•ï¼ˆdoneï¼‰è¿”å›
            return {
                done: done,
                value: value
            }
        }
    }
}

var iterator = iteratorGenerator(['1å·é€‰æ‰‹', '2å·é€‰æ‰‹', '3å·é€‰æ‰‹'])
iterator.next() // {done: false, value: '1å·é€‰æ‰‹'}
iterator.next() // {done: false, value: '2å·é€‰æ‰‹'}
iterator.next() // {done: false, value: '3å·é€‰æ‰‹'}
// iterator.next() // {done: true, value: undefined}
```
