# 什么是HTTP

## 基本概念

HTTP 是一个在计算机世界里专门在「两点」之间「传输」文字、图片、音频、视频等「超文本」数据的「约定和规范」。

这里的两点可以是：

- 客户端（浏览器） <==> 服务器（服务端）
- 服务器 <==> 服务器

### 状态码

见 [状态码这一节内容](./状态码.md)

### 字段

- **Host** 字段：客户端发送请求时，用来指定服务器的域名。
- **Content-Length** 字段：服务器在返回数据时，会有 Content-Length 字段，表明本次回应的数据长度。
- **Connection** 字段：该字段最常用于客户端要求服务器使用 TCP 持久连接，以便其他请求复用。
  - HTTP/1.1 版本的默认连接都是持久连接，但为了兼容老版本的 HTTP，需要指定 Connection 首部字段的值为 Keep-Alive 。（`Connection: keep-alive`）
  - 一个可以复用的 TCP 连接就建立了，直到客户端或服务器主动关闭连接。但是，这不是标准字段。
- **Content-Type** 字段：用于服务器回应时，告诉客户端，本次数据是什么格式。
  - `Content-Type: text/html; charset=utf-8`：发送的是网页，而且编码是UTF-8。
  - `Content-Type: Accept: */*`：表示客户端可以接受任何类型的数据。
- **Content-Encoding** 字段：说明数据的压缩方法。表示服务器返回的数据使用了什么压缩格式
  - `Content-Encoding: gzip`：表示服务器返回的数据使用了 gzip 压缩。
  - 客户端在请求时，用 `Accept-Encoding` 字段说明自己可以接受哪些压缩方法。（`Accept-Encoding: gzip, deflate`）

## HTTP特点

优点：HTTP 最凸出的优点是「简单、灵活和易于扩展、应用广泛和跨平台」。

缺点：HTTP 协议里有优缺点一体的双刃剑，分别是「无状态、明文传输」，同时还有一大缺点「不安全」。

### 仔细描述

- 简单：HTTP 基本的报文格式就是 header + body ，头部信息也是 key-value 简单文本的形式，易于理解，降低了学习和使用的门槛。
- 灵活和易于扩展：HTTP协议里的各类请求方法、URI/URL、状态码、头字段等每个组成要求都没有被固定死，都允许开发人员自定义和扩充。
- 应用广泛和跨平台：互联网发展至今，HTTP 的应用范围非常的广泛，从台式机的浏览器到手机上的各种 APP，从看新闻、刷贴吧到购物、理财、吃鸡，HTTP 的应用片地开花，同时天然具有跨平台的优越性。

---

- 无状态双刃剑
  - 好处：因为服务器不会去记忆 HTTP 的状态，所以不需要额外的资源来记录状态信息，这能减轻服务器的负担，能够把更多的 CPU 和内存用来对外提供服务。
  - 坏处：既然服务器没有记忆能力，它在完成有关联性的操作时会非常麻烦。

> 对于无状态的问题，解法方案有很多种，其中比较简单的方式用 Cookie 技术。

- 明文传输双刃剑
  - 好处：明文意味着在传输过程中的信息，是可方便阅读的，通过浏览器的 F12 控制台或 Wireshark 抓包都可以直接肉眼查看，为我们调试工作带了极大的便利性。
  - 坏处：但是这正是这样，HTTP 的所有信息都暴露在了光天化日下，相当于信息裸奔。在传输的漫长的过程中，信息的内容都毫无隐私可言，很容易就能被窃取

- 不安全：HTTP 比较严重的缺点就是不安全
  - 通信使用明文（不加密），内容可能会被窃听。
  - 不验证通信方的身份，因此有可能遭遇伪装。
  - 无法证明报文的完整性，所以有可能已遭篡改。

> HTTP 的安全问题，可以用 HTTPS 的方式解决，也就是通过引入 SSL/TLS 层，使得在安全上达到了极致。

## HTTP1.1特点

HTTP 协议是基于 `TCP/IP`，并且使用了 `「请求 - 应答」`的通信模式，所以性能的关键就在这两点里

因此，HTTP1.1 协议的特点就是：

- 长连接
- 管道网络传输

不过依然存在的问题：

- 队头阻塞

### 描述

长链接：

- `HTTP/1.0`的时候每发起一个请求，都要新建一次 TCP 连接（三次握手），而且是串行请求。（做了无谓的 TCP 连接建立和断开，增加了通信开销）
- `HTTP/1.1`提出了长连接的通信方式，也叫持久连接。（减少了 TCP 连接的重复建立和断开所造成的额外开销，减轻了服务器端的负载）

> 持久连接的特点是，只要任意一端没有明确提出断开连接，则保持 TCP 连接状态。

管道网络传输：

- 好处：在同一个 TCP 连接里面，客户端可以发起多个请求，只要第一个请求发出去了，不必等其回来，就可以发第二个请求出去，可以减少整体的响应时间。
- 存在问题：但是服务器还是按照顺序，先回应 A 请求，完成后再回应 B 请求。要是前面的回应特别慢，后面就会有许多请求排队等着。这称为「队头堵塞」。

> HTTP/1.1 采用了长连接的方式，这使得管道（pipeline）网络传输成为了可能。

队头阻塞：

因为当顺序发送的请求序列中的一个请求因为某种原因被阻塞时，在后面排队的所有请求也一同被阻塞了，会招致客户端一直请求不到数据

> 总之 HTTP/1.1 的性能一般般，后续的 HTTP/2 和 HTTP/3 就是在优化 HTTP 的性能。

<!-- 改进：

- 使用 TCP 长连接的方式改善了 HTTP/1.0 短连接造成的性能开销。
- 支持管道（pipeline）网络传输，只要第一个请求发出去了，不必等其回来，就可以发第二个请求出去，可以减少整体的响应时间。

存在的问题：

- 请求 / 响应头部（Header）未经压缩就发送，首部信息越多延迟越大。只能压缩 Body 的部分； -->

## HTTPS

### 与HTTP的区别

- HTTP 的端口号是 80，HTTPS 的端口号是 443。
- HTTPS 则解决了 HTTP 不安全的缺陷，在 TCP 和 HTTP 网络层之间加入了 SSL/TLS 安全协议，使得报文能够加密传输。
- HTTPS 在 TCP三次握手之后，还需进行 SSL/TLS 的握手过程，才可进入加密报文传输。
- HTTPS 协议需要向 CA（证书权威机构）申请数字证书，来保证服务器的身份是可信的。（需要花钱）

> SSL/TLS 可以理解为同一个东西，只是叫法不同

### HTTP存在的风险问题

- **窃听风险**（通信链路上可以获取通信内容）
- **篡改风险**（强制植入垃圾广告，视觉污染）
- **冒充风险**（冒充网站，如淘宝网）

### SSL/TLS 协议

- **信息加密**：交互信息无法被窃取
- **校验机制**：无法篡改通信内容，篡改了就不能正常显示
- **身份证书**：证明是真正的网址，如淘宝网

SSL/TLS 协议基本流程：

- 客户端向服务器索要并验证服务器的公钥。
- 双方协商生产「会话秘钥」
- 双方采用「会话秘钥」进行加密通信。

前两步也就是 SSL/TLS 的建立过程，也就是握手阶段。

### 如何做到

- **混合加密**：通过混合加密的方式可以保证信息的机密性，解决了窃听的风险。
- **摘要算法**：实现完整性，它能够为数据生成独一无二的「指纹」，指纹用于校验数据的完整性，解决了篡改的风险。
- 将服务器公钥放入到数字证书中，解决了冒充的风险。

什么是混合加密:

HTTPS 采用的是`对称加密`和`非对称加密`结合的「混合加密」方式

- 在通信建立前采用`非对称加密`的方式交换「会话秘钥」，后续就不再使用非对称加密。
- 在通信过程中全部使用`对称加密`的「会话秘钥」的方式加密明文数据。

采用混合加密的原因：

- `对称加密`只使用一个密钥，运算速度快，密钥必须保密，无法做到安全的密钥交换。
- `非对称加密`使用两个密钥：公钥和私钥，公钥可以任意分发而私钥保密，解决了密钥交换问题但速度慢。

---

摘要算法：

1. 客户端在发送明文之前会通过摘要算法算出明文的「指纹」
2. 发送的时候把「指纹 + 明文」一同加密成密文后，发送给服务器
3. 服务器解密后，用相同的摘要算法算出发送过来的明文，通过比较客户端携带的「指纹」和当前算出的「指纹」做比较，若「指纹」相同，说明数据是完整的。

![摘要算法](/static/images/http-abstract-algorithm.jpg)

数字证书：

客户端先向服务器端索要公钥，然后用公钥加密信息，服务器收到密文后，用自己的私钥解密。

为了保证公钥不被篡改和信任度，这里就需要借助第三方权威机构 CA （数字证书认证机构），将服务器公钥放在数字证书（由数字证书认证机构颁发）中，只要证书是可信的，公钥就是可信的。

通过数字证书的方式保证服务器公钥的身份，解决冒充的风险。
