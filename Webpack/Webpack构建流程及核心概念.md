# Webpack 构建流程及核心概念

## webpack 基本作用

- **模块打包**
  - 可以将不同模块的文件打包整合在一起，并且保证它们之间的引用正确，执行有序
  - 利用打包我们就可以在开发的时候根据我们自己的业务自由划分文件模块，保证项目结构的清晰和可读性
- **编译兼容**
  - 通过webpack的Loader机制，不仅仅可以帮助我们对代码做polyfill，还可以编译转换诸如.less, .vue, .jsx这类在浏览器无法识别的格式文件，让我们在开发的时候可以使用新特性和新语法做开发，提高开发效率
- **能力扩展**
  - 通过webpack的Plugin机制，我们在实现模块化打包和编译兼容的基础上，可以进一步实现诸如按需加载，代码压缩等一系列功能，帮助我们进一步提高自动化程度，工程效率以及打包输出的质量。

## 构建流程

Webpack 的运行流程是一个串行的过程，从启动到结束会依次执行以下流程：

1. 初始化参数，从配置文件和 Shell 语句中读取与合并参数，得出最终的参数
2. 启动webpack，创建 `Compiler`对象并开始解析项目
3. 从入口文件（`entry`）开始解析，并且找到其导入的依赖模块，递归遍历分析，形成依赖关系树
4. 对不同文件类型的依赖模块文件使用对应的 `Loader`进行编译，最终转为 `Javascript`文件
5. 整个过程中webpack会广播许多事件（通过发布订阅模式），向外抛出一些`hooks`，而webpack的插件（`Plugin`）即可通过监听这些关键的事件节点，执行插件任务进而达到干预输出结果的目的。

Webpack 的构建流程可以分为以下三大阶段：

1. 初始化：启动构建，读取与合并配置参数，加载 Plugin，实例化 Compiler。
2. 编译：从 Entry 发出，针对每个 Module 串行调用对应的 Loader 去翻译文件内容，再找到该 Module 依赖的 Module，递归地进行编译处理
3. 输出：对编译后的 Module 组合成 Chunk，把 Chunk 转换成文件，输出到文件系统。

## 核心概念

### compiler和compilation对象

- compiler对象是一个全局单例，他负责把控整个webpack打包的构建流程。
- compilation对象是每一次构建的上下文对象，它包含了当次构建所需要的所有信息

每次热更新和重新构建，compiler都会重新生成一个新的compilation对象，负责此次更新的构建过程。

compiler 暴露了和 Webpack 整个生命周期相关的钩子，compilation 暴露了与模块和依赖有关的粒度更小的事件钩子

## webpack事件机制

Webpack的事件机制基于webpack自己实现的一套Tapable事件流方案

## 资料

- [当面试官问Webpack的时候他想知道什么](https://juejin.cn/post/6943468761575849992)
